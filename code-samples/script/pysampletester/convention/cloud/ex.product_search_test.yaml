test:
  suites:
  - name: "Declarative test"
    setup:
    - uuid: product_id
    - log:
        - "UUID is {}"
        - product_id
    - code: | # Note that we can intersperse code if we wish. It's just another YAML directive.
        log("Product ID for this test suite is {}", product_id)
    teardown:
    - call_may_fail:
        target: "testdata/samples/vision/product-search/delete_product.py  "
        args:
        - variable: product_id
    - code: |
    cases:
    - name: Product Life
      spec:
      - call:
          target: "testdata/samples/vision/product-search/list_products.py"
      - assert_not_contains:
          - variable: product_id
      - call:
          target: "testdata/samples/vision/product-search/create_product.py"
          args:
          - variable: product_id
          - literal: Fancier towel
          - literal: homegoods
      - call:
          target: "testdata/samples/vision/product-search/list_products.py"
      - assert_contains:
          - variable: product_id
          - literal: "towel"
      - call:
          target: "testdata/samples/vision/product-search/delete_product.py"
          args:
          - variable: product_id
      - call:
          target: "testdata/samples/vision/product-search/list_products.py"
      - assert_not_contains:
          - variable: product_id


  - name:  "Procedural test"
    setup:
    - code: |
        product_id=uuid()
        log("Product ID for this test suite is {}", product_id)
    teardown:
    - code: |
        call_may_fail("testdata/samples/vision/product-search/delete_product.py", product_id)

    cases:
    - name: Product Life
      spec:
      - code: |
          out = call("testdata/samples/vision/product-search/list_products.py")
          assert_that(product_id not in out, "the product {} should initially be absent", product_id)
  
          call("testdata/samples/vision/product-search/create_product.py", product_id, "Fancier towel", "homegoods")
  
          out = call("testdata/samples/vision/product-search/list_products.py")
          assert_that(product_id in out, "the product {} should be {} quite present after creation", product_id, "really")
  
          call("testdata/samples/vision/product-search/delete_product.py", product_id)
  
          out = call("testdata/samples/vision/product-search/list_products.py")
          assert_that(product_id not in out, "the product {} should be absent after deletion", product_id)
